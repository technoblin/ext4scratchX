!function(window){"use strict";function makeModule(){var Trad={traduir:function(e,t){var n=this[e];for(var r in t)n=n.replace("%"+r,t[r]);return n},exception:"Exception %message à la ligne %lineNumber\n%stack",declaration:" - Créer nouveau %name sur la sortie %addr.",reinit:" - Réinitialiser %name.",addModule:"GrovePi.addModule(%name%opt)",getModule:"GrovePi.getModule(%name)",order:"Réception de l'ordre %order, %message.",addMatrix:"TSnéoLED.addMatrix(%con, %width, %height)",err_1:"Impossible d'initialiser le module %name, il y a un conflict d'adresse.",err_2:"Vous n'avez pas initialisé la matrice du port %port du shield TSNéoLed!!!",err_3:"Vous n'avez pas initialisé le shield GrovePi + avant de l'utiliser!!!",err_4:"Vous n'avez pas initialisé le module %module avant de l'utiliser!!!",err_5:"Vous n'avez pas initialisé de module sur la broche D%addr avant de l'utiliser!!!",err_6:"Vous n'avez pas initialisé le shield TSNéoLed avant de l'utiliser!!!",err_7:"La fonction addEvent n'est pas prise en charge.",menu_file:"Fichier",menu_file_open:"Ouvrir un fichier de mise en place",menu_file_save:"Enregistrer cette mise ne place"},priv={GrovePi:null,TSNeoLed:null,ServoHat:{},ext_tools:null,debug:3},menus=newIndexed(),menu_top=newElement("div","bandeau"),menu=newElement("div","menu_context"),input=newElement("input"),div=newElement("div"),svg=newSVG("svg");input.type="file",input.accept=".placement",input.style.display="none",addEvent(input,"change",function(){if(window.FileReader){var e=new FileReader,t=input.files[0];addEvent(e,"loadend",function(e){e.target.readyState==FileReader.DONE&&(unserialize(e.target.result),resizeCaneva())}),addEvent(e,"error|abord",function(e){alert("Faire la fonction ouvrir un fichier en distant")}),e.readAsBinaryString(t)}input.value=""}),document.body.appendChild(menu_top),document.body.appendChild(menu),document.body.appendChild(div),document.body.appendChild(input),addEvent(document.body,"contextmenu",function(e){return void 0!=e.preventDefault&&e.preventDefault(),!1}),div.appendChild(svg),fillStyle(div,{position:"absolute",top:"20px",left:"0px",minWidth:"100%",minHeight:"100%"}),fillSVG(svg,{width:"800",height:"600"});var formular=newElement("div");function resizeCaneva(){var e=svg.getBBox();fillSVG(svg,{width:e.x+e.width+10,height:e.y+e.height+10})}document.body.appendChild(formular),fillStyle(formular,{position:"absolute",top:"24px",left:"0px"});var style=newElement("link");style.type="text/css",style.rel="stylesheet",style.href="https://technoblin.github.io/ext4scratchX/lib/style.css",document.getElementsByTagName("head")[0].appendChild(style);var timerMenu=null;function cacher_menu(){null!=timerMenu&&clearTimeout(timerMenu),timerMenu=setTimeout(function(){timerMenu=null,menu.style.display="none"},100)}function ajouterMenuTitle(e,t,n,r){menus.have(e)||menus.set(e,{div:newElement("div"),items:newIndexed()});var o=menus.get(e),i=newElement("div");i.className="menu_context_ligne";var a=newElement("nobr");i.appendChild(a);var l=newElement("div");l.className="menu_context_img";var d=newImage(t,n);l.appendChild(d),a.appendChild(l);var c=newElement("div");c.className="menu_context_title",c.appendChild(newText(r)),a.appendChild(c),o.div.appendChild(i)}function ajouterMenuItem(e,t,n,r,o){menus.have(e)||menus.set(e,{div:newelement("div"),items:newindexed()});var i=menus.get(e),a=newElement("div");a.className="menu_context_ligne lien";var l=newElement("nobr");a.appendChild(l);var d=newElement("div");d.className="menu_context_img";var c=newImage(t,n);d.appendChild(c),l.appendChild(d);var s=newElement("div");s.className="menu_context_txt",s.appendChild(newText(r)),l.appendChild(s),addEvent(a,"click",function(){null!=timerMenu&&(clearTimeout(timerMenu),timerMenu=null),menu.style.display="none",o()}),i.div.appendChild(a),i.items.set(t,a)}function selectItem(e,t,n){menus.have(e)&&menus.get(e).items.have(t)&&(menus.get(e).items.get(t).className=n?"menu_context_ligne lien":"menu_context_unselect")}function afficherMenu(e,t){if(menus.have(e)){null!=timerMenu&&(clearTimeout(timerMenu),timerMenu=null),menu.style.display="none",cleanElement(menu);try{$(menu).fadeIn(200)}catch(e){}menu.appendChild(menus.get(e).div),menu.style.display="block";try{var n=$(t).position();menu.style.left=n.left+"px",menu.style.top=10+n.top+"px"}catch(e){console.error(e)}}}function ajouterItem(e,t,n,r){var o=newElement("div");o.className="menu_context_ligne lien";var i=newElement("nobr");o.appendChild(i);var a=newElement("div");a.className="menu_context_img";var l=newImage(e,t);a.appendChild(l),i.appendChild(a);var d=newElement("div");d.className="menu_context_txt",d.appendChild(newText(n)),i.appendChild(d),addEvent(o,"click",function(){menu.style.display="none";try{r()}catch(e){console.error(e)}}),menu.appendChild(o)}function afficherMenuAjout(e,t,n,r){null!=timerMenu&&(clearTimeout(timerMenu),timerMenu=null),menu.style.display="none",cleanElement(menu);try{$(menu).fadeIn(200)}catch(e){}ajouterItem("action","images/icon_action.png","Ajouter une action",function(){var n=newBlock("action",null);n.fils[0]=e.fils[t],e.fils[t]=n,exercice.redraw()}),ajouterItem("test","images/icon_test.png","Ajouter un test",function(){var n=newBlock("test",null);n.fils[0]=e.fils[t],e.fils[t]=n,exercice.redraw()}),ajouterItem("branchement","images/icon_branche.png","Ajouter un branchement",function(){var n=newBlock("branchement",null);n.fils[0]=e.fils[t],e.fils[t]=n,exercice.redraw()}),ajouterItem("fin","images/icon_fin.png","Ajouter une fin",function(){var n=newBlock("fin",null);n.fils[0]=e.fils[t],e.fils[t]=n,exercice.redraw()}),ajouterItem("timer","images/icon_timer.png","Ajouter un timer",function(){var n=newBlock("timer",3);n.fils[0]=e.fils[t],e.fils[t]=n,exercice.redraw()}),ajouterItem("attacher","images/icon_attacher.png","Relier la sortie à ...",function(){addC={chaine:e,s:t}}),menu.style.display="block";var o=$(r).position(),i=o.left,a=o.top;i=i+menu.offsetWidth>EnvData.width()?i-menu.offsetWidth:i,a=a+menu.offsetHeight>EnvData.height()?a-menu.offsetHeight:a,i<0&&(i=0),a<15&&(a=15),menu.style.left=i+"px",menu.style.top=a+"px"}function afficherMenuBloque(e){if(null!=timerMenu&&(clearTimeout(timerMenu),timerMenu=null),menu.style.display="none",!running&&e!=debut){cleanElement(menu);try{$(menu).fadeIn(200)}catch(e){}"action"==e.type?ajouterItem("change","images/icon_change.png","Changer l'action",function(){modifierBloque(e)}):ajouterItem("change","images/icon_change.png","Changer la condition",function(){modifierBloque(e)}),ajouterItem("action","images/icon_action.png","Ajouter une action avant",function(){var t=newBlock("action",null);blocks.call(function(n){n.fils[0]==e&&(n.fils[0]=t),n.fils[1]==e&&(n.fils[1]=t)}),t.fils[0]=e,exercice.redraw()}),ajouterItem("test","images/icon_test.png","Ajouter un test avant",function(){var t=newBlock("test",null);blocks.call(function(n){n.fils[0]==e&&(n.fils[0]=t),n.fils[1]==e&&(n.fils[1]=t)}),t.fils[0]=e,exercice.redraw()}),ajouterItem("branchement","images/icon_branche.png","Ajouter un branchement avant",function(){var t=newBlock("branchement",null);blocks.call(function(n){n.fils[0]==e&&(n.fils[0]=t),n.fils[1]==e&&(n.fils[1]=t)}),t.fils[0]=e,exercice.redraw()}),ajouterItem("timer","images/icon_timer.png","Ajouter un timer avant",function(){var t=newBlock("timer",3);blocks.call(function(n){n.fils[0]==e&&(n.fils[0]=t),n.fils[1]==e&&(n.fils[1]=t)}),t.fils[0]=e,exercice.redraw()}),ajouterItem("supprimer","images/icon_supprimer.png","Supprimer le noeud",function(){var t=LightBox.errorDescription("Attention !!!");t.add("Voulez-vous supprimer définitivement le noeud ?");var n=newListe();n.add({label:Traducteur.GetMessage("Oui"),callback:function(){e.type="NOP",exercice.redraw(),LightBox.close()}}),n.add({label:Traducteur.GetMessage("Non"),callback:function(){LightBox.close()}}),LightBox.demanderMessage(t.message,n)}),null!=e.fils[0]&&ajouterItem("broke","images/icon_broke.png","Détacher du noeud suivant",function(){e.fils[0]=null,exercice.redraw()}),"branchement"==e.type&&null!=e.fils[1]&&ajouterItem("broke","images/icon_broke.png","Détacher du noeud à droite",function(){e.fils[1]=null,exercice.redraw()}),menu.style.display="block";var t=$(e.bloque).position(),n=t.left,r=t.top;n=n+menu.offsetWidth>EnvData.width()?n-menu.offsetWidth:n,r=r+menu.offsetHeight>EnvData.height()?r-menu.offsetHeight:r,n<0&&(n=0),r<15&&(r=15),menu.style.left=n+"px",menu.style.top=r+"px"}}function trace(e,t,n){console.log(n),priv.debug>=e&&(void 0==n?console.log(Trad[t]):console.log(Trad.traduir(t,n)))}function opt2str(e){var t="";if(isSet(e))switch(typeof e){case"object":for(var n in e)t+=", "+n+":"+serial(e[n]);break;case"function":t=", function "+e+"()";break;default:t=", "+e}return t}function min(e,t){return e<t?e:t}function max(e,t){return e<t?t:e}function dif(e,t){return e<t?t-e:e-t}function isSet(e){return 0!=e&&void 0!=e&&null!=e}function newElement(e,t){var n=document.createElement(e);return isSet(t)&&(n.className=t),n}function newText(e){return document.createTextNode(e)}function fillStyle(e,t){if(isSet(e))for(var n in t)e.style[n]=t[n]}function newSVG(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function fillSVG(e,t){if(isSet(e))for(var n in t)e.setAttribute(n,t[n])}function cleanElement(e){try{if(void 0!=e.lastChild)for(;null!=e.lastChild;)e.removeChild(e.lastChild)}catch(e){}}function intToCol(e){for(var t=parseInt(e).toString(16);t.length<6;)t="0"+t;return"#"+t}function intToColLow(e,t){var n=16711680&e,r=65280&e,o=255&e;return intToCol((16711680&(n/=t))+(65280&(r/=t))+(255&(o/=t)))}function alpha(e){var t=255&(e=parseInt(e)),n=255&(e=(e-t)/256);return e=(e-n)/256,n>t&&(t=n),(n=255&e)>t&&(t=n),.1+t/300}function addr2hex(e){return(e=parseInt(e).toString(16)).length%2!=0&&(e="0"+e),"0x"+e}function serial(e){if(void 0==e)return"undefined";if(null==e)return"null";switch(typeof e){case"object":var t="",n="{";for(var r in e)t+=n+r+':"'+serial(e[r])+'"',n=" ,";return t+"}";case"function":return"function "+e+"()"}return e}function clear(e){for(;null!=e.firstChild;)e.removeChild(e.firstChild)}function decodeText(e){for(var t="",n=0;n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t}function addEvent(element,type,callback){if(void 0!=callback&&null!=callback){if("function"!=typeof callback){var code=callback;callback=function(){eval(code)}}for(var f=function(e){try{isSet(e.stopPropagation)&&e.stopPropagation()}catch(e){}try{return callback(e)}catch(e){trace(1,"exception",e)}},t=type.split("|"),i=0;i<t.length;i++)t[i].length>0&&(isSet(element.addEventListener)?element.addEventListener(t[i],f):isSet(element.attachEvent)?element.attachEvent("on"+t[i],f):trace(1,"err_7"))}}function addEventClick(element,action_click,action_dblclick){var clicks=0,timer=null;if(void 0!=action_click&&null!=action_click||(action_click=function(){}),"function"!=typeof action_click){var code=action_click;action_click=function(){eval(code)}}if(void 0!=action_dblclick&&null!=action_dblclick||(action_dblclick=function(){}),"function"!=typeof action_dblclick){var code=action_dblclick;action_dblclick=function(){eval(code)}}addEvent(element,"click",function(e){if(1==++clicks)timer=setTimeout(function(){try{action_click(e)}catch(e){console.error(e)}clicks=0},400);else{clearTimeout(timer);try{action_dblclick(e)}catch(e){console.error(e)}clicks=0}})}function newImage(e,t){var n=newElement("img");return n.src=t,addEvent(n,"error",function(){n.parentNode.removeChild(n)}),n}function newAudio(){try{if("function"==typeof Audio)return new Audio;if("function"==typeof Element)return new Element("audio",{})}catch(e){console.error(e)}return null}function newIndexed(e){var t={},n={set:function(e,n){t[e]={index:e,value:n}},get:function(e){if(void 0!=t[e])return t[e].value},unset:function(e){t[e]=void 0},have:function(e){return void 0!=t[e]},serialize:function(){var e={};for(var n in t)void 0!=t[n]&&(e[n]=t[n].value);return e},init:function(e){if(isSet(e)){isSet(e.serialize)&&(e=e.serialize());for(i in e)this.set(i,e[i])}},clone:function(e){isSet(e)||(e=!1);var n=newIndexed();for(var r in t)if(void 0!=t[r]){if(e){try{if(isSet(t[r].value.cloneNode)){n.add(r,t[r].value.cloneNode(e));continue}}catch(e){}try{if(isSet(t[r].value.clone)){n.add(r,t[r].value.clone(e));continue}}catch(e){}}n.add(r,t[r].value)}return n},call:function(e){for(var n in t)void 0!=t[n]&&e(n,t[n].value)},free:function(){t={}}};return n.init(e),n}function newEnvData(){var e={souris:{x:0,y:0},infobulle:newElement("div"),move:{count:0}};return e.infobulle.className="noprint infobulle",addEvent(document,"mousemove",function(t){if(t.pageX?(e.souris.x=t.pageX,e.souris.y=t.pageY):t.clientX&&(e.souris.x=t.clientX+document.body.scrollLeft,e.souris.y=t.clientY+document.body.scrollTop),"block"==e.infobulle.style.display){var n=e.souris.x,r=e.souris.y;n=n+e.infobulle.offsetWidth>EnvData.width()?n-e.infobulle.offsetWidth:n,r=r+e.infobulle.offsetHeight>EnvData.height()?r-e.infobulle.offsetHeight:r+15,n<0&&(n=0),r<0&&(r=0),e.infobulle.style.left=n+"px",e.infobulle.style.top=r+"px"}for(var o=0;o<e.move.count;o++)if(null!=e.move[o])try{e.move[o](e.souris)}catch(e){}}),{addBubble:function(t,n){addEvent(t,"mouseover",function(){var t;isSet(t=n)&&(e.infobulle.innerHTML="<div class='infobulle_contenu' style='text-align:"+(t.length>30?"left;":"center;")+"'>"+t+"</div>",e.infobulle.style.display="block",null==e.infobulle.parentNode&&document.body.appendChild(e.infobulle))}),addEvent(t,"mouseout",function(){e.infobulle.style.display="none"})},hideBubble:function(){e.infobulle.style.display="none"},souris:function(t,n){if(!isSet(t))return e.souris;var r=$(t).position(),o=$(t).width(),i=$(t).height();return e.souris.x>r.left&&e.souris.x<r.left+o&&e.souris.y>r.top&&e.souris.y<r.top+i?{x:e.souris.x-r.left,y:e.souris.y-r.top}:n?{x:e.souris.x-r.left,y:e.souris.y-r.top}:{x:0,y:0}},scrollTop:function(){return void 0!=window.pageYOffset?window.pageYOffset:void 0!=document.documentElement?document.documentElement.scrollTop:0},scrollLeft:function(){return void 0!=window.pageXOffset?window.pageXOffset:void 0!=document.documentElement?document.documentElement.scrollLeft:0},height:function(){return $(window).height()},width:function(){return $(window).width()},goToByScroll:function(e,t){isSet(t)?vTop=t.offsetTop:(vTop=60,t=document.body),$(t).animate({scrollTop:e.offsetTop()-vTop},"slow")},alignTable:function(e){for(var t=e.getElementsByTagName("table"),n={},r=0;r<t.length;r++)for(var o=1,i=t[r].firstChild.firstChild;null!=i;i=i.nextSibling)void 0==n[o]?n[o]=i.offsetWidth:n[o]=Math.max(n[o],i.offsetWidth),o++;for(r=0;r<t.length;r++)for(o=1,i=t[r].firstChild.firstChild;null!=i;i=i.nextSibling)i.style.width=n[o]+10+"px",o++},navigateur:function(){try{if(nav=navigator.userAgent.toLowerCase(),trouver("msie",nav))return"ie";if(trouver("firefox",nav))return"firefox";if(trouver("chrome",nav))return"chrome";if(trouver("safari",nav))return"safari";if(trouver("webkit",nav))return"webkit";if(trouver("opera",nav))return"opera";if(trouver("netscape",nav))return"netscape";popupStatus(nav,5)}catch(e){}return"nothing"},isMobileDevice:function(){return!!/Android|iPhone|iPad|iPod|BlackBerry|windows phone|tablet|Touch/i.test(navigator.userAgent)},version_ie:function(){if("ie"==navigateur()){var e=navigator.appVersion.split("MSIE");return parseFloat(e[1])}},isPrivateMode:function(){return"function"==typeof window.openPrivateWindow||void 0!=window.clientInformation&&"1"==window.clientInformation.msDoNotTrack},setMicroRequette:function(e,t){window.history.pushState({foo:"bar"},e,t)},addMouseMove:function(t){if("function"==typeof t){var n=e.move.count++;return e.move[n]=t,n}return-1},removeMouseMove:function(t){t>=0&&t<e.move.count&&(e.move[i]=null)}}}addEvent(menu,"mouseout",function(){cacher_menu()}),addEvent(menu,"mouseover",function(){null!=timerMenu&&(clearTimeout(timerMenu),timerMenu=null),menu.style.display="block"});var EnvData=newEnvData();function serialize(){var e="{";return null==priv.GrovePi?e+="NULL":e+=priv.GrovePi.serialize(),e+=";",null==priv.TSNeoLed?e+="NULL":e+=priv.TSNeoLed.serialize(),(e+=";")+"}"}function unserialize(e){var t;if(null!=(t=e.match(/^{(.*)}$/))){if(null==(t=(e=t[1]).match(/^((NULL)|(GrovePi\([^)]*\){({[^}]*})*}));(.*)/)))return!1;if("NULL"!=t[1]&&null!=priv.GrovePi?priv.GrovePi.unserialize(t[1]):null!=priv.GrovePi&&!1,null==(t=(e=t[5]).match(/^((NULL)|(TSNeoLed\([^)]*\){({[^}]*})*}));(.*)/)))return!1;"NULL"!=t[1]&&null!=priv.TSNeoLed?priv.TSNeoLed.unserialize(t[1]):null!=priv.TSNeoLed&&!1,e=t[5]}}var board_name=newElement("span","menu_entry");menu_top.appendChild(board_name);var file=newElement("span","menu_entry");file.appendChild(newText(Trad.menu_file)),menu_top.appendChild(file),addEvent(file,"mouseover",function(){afficherMenu("fichier",file)}),addEvent(file,"mouseout",function(){cacher_menu()}),ajouterMenuTitle("fichier","file","icon_file",Trad.menu_file),ajouterMenuItem("fichier","open","icon_open",Trad.menu_file_open,function(){input.click()}),ajouterMenuItem("fichier","save","icon_save",Trad.menu_file_save,function(){var e=newElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(serialize())),e.setAttribute("download","Virtual.placement"),e.style.display="none",document.body.appendChild(e),e.click(!0),document.body.removeChild(e)});var version=newElement("span");version.className="menu_version",version.appendChild(newText("Simulateur by Ethernety.net")),EnvData.addBubble(version,"Simulateur extension 4 scratchX by Ethernety.net<br />Entièrement codé par Jean BLIN - technoblin@free.fr"),menu_top.appendChild(version),addEvent(version,"click",function(){window.open("http://scratch.ethernety.net")});var drop={type:null,dev:null,position:null,x:0,dx:0,y:0,dy:0};function startMove(e){var t=EnvData.souris();drop.type="m",drop.dev=e,drop.position=e.position(),drop.dx=t.x,drop.dy=t.y,e.select(!0),e.callEvent()}function startRotate(e){var t=EnvData.souris();drop.type="r",drop.dev=e,drop.position=e.position(),drop.dx=t.x,drop.dy=t.y,e.select(!0),e.callEvent()}function startSlide(e){var t=EnvData.souris();drop.type="s",drop.dev=e,drop.pos=e.get(),drop.dx=t.x,e.select(!0),e.callEvent()}function stopDrop(){null!=drop.dev&&(drop.type=null,drop.dev.select(!1),drop.dev=null)}function dropEffect(e){switch(drop.type){case"m":var t,n,r=drop.dev.getBBox();t=r.x+drop.position.x+e.x-drop.dx>0?drop.position.x+e.x-drop.dx:-r.x,n=r.y+drop.position.y+e.y-drop.dy>0?drop.position.y+e.y-drop.dy:-r.y,drop.dev.move(t,n),resizeCaneva();break;case"r":var o=drop.position.a;dif(e.x,drop.dx)>dif(e.y,drop.dy)?o+=e.x-drop.dx:o+=e.y-drop.dy,drop.dev.rotate(o),resizeCaneva();break;case"s":drop.dev.set(drop.pos+e.x-drop.dx)}}EnvData.addMouseMove(dropEffect);var select_pos=null,select_box=newSVG("rect");function connectionSend(e){try{null==priv.ext_tools?setTimeout(function(){connectionSend(e)},100):priv.ext_tools.onMessage(e)}catch(e){trace(1,"exception",e)}}function dataUpdate(e,t){try{null==priv.ext_tools?setTimeout(function(){dataUpdate(e,t)},100):priv.ext_tools.setSensorData(e,t)}catch(e){trace(1,"exception",e)}}function error(e,t){void 0==t?priv.ext_tools.error(Trad[e]):priv.ext_tools.error(Trad.traduir(e,t))}function newFormular(){var e=newSVG("g");svg.appendChild(e);var t=newSVG("path");e.appendChild(t),fillSVG(t,{fill:"#eee",stroke:"#111","stroke-width":"0.7"});var n=newSVG("g");function r(e){var r=n.getBBox();n.appendChild(e),fillSVG(e,{transform:"translate(0,"+r.height+")"});r=n.getBBox();fillSVG(t,{d:"m0,-2 h"+r.width+" q2,0 2,2 v"+r.height+" q0,2 -2,2 h-"+r.width+" q-2,0 -2,-2 v-"+r.height+" q0,-2 2,-2 z"})}return e.appendChild(n),{addLabel:function(e){var t,n,o;t=e,n=newSVG("g"),(o=newSVG("text")).appendChild(newText(t)),fillSVG(o,{fill:"#111","font-size":"11","font-family":"Times New Roman",x:0,y:10}),n.appendChild(o),r(n)},addSlidebar:function(e,t,n,o){!function(e,t,n,o){var i=newSVG("g"),a=newSVG("path");fillSVG(a,{fill:"#229",stroke:"#111","stroke-width":"0.5",d:"m2,2 h46 q2,0 2,2 v3 q0,2 -2,2 h-46 q-2,0 -2,-2 v-3 q0,-2 2,-2 z"}),i.appendChild(a);var l=newSVG("path");fillSVG(l,{fill:"#eee",stroke:"#222","stroke-width":"0.7",d:"m1,0 h2 q1,0 1,1 v9 q0,1 -1,1 h-2 q-1,0 -1,-1 v-9 q0,-1 1,-1 z"}),i.appendChild(l);var d=Math.floor(46*(n-e)/(t-e));fillSVG(l,{transform:"translate("+d+",0)"});var c={get:function(){return d},set:function(e){(d=e)<0?d=0:d>46&&(d=46),fillSVG(l,{transform:"translate("+d+",0)"}),o(this.value())},value:function(){return e+Math.floor(d*(t-e)/46)},select:function(e){fillSVG(l,{stroke:e?"#555":"#222","stroke-width":e?"1":"0.7"})},callEvent:function(){i.removeChild(l),i.appendChild(l)}};addEvent(l,"mousedown",function(e){return e.stopPropagation(),1==e.buttons&&startSlide(c),!1}),r(i)}(e,t,n,o)},addInput:function(e,t){var n,o,i;n=e,o=newSVG("g"),(i=newSVG("text")).appendChild(newText(n)),fillSVG(i,{contentEditable:"true"}),o.appendChild(i),r(o)},move:function(t,n){fillSVG(e,{transform:"translate("+t+","+n+")"})},hide:function(){fillSVG(e,{opacity:0,width:0,height:0})},show:function(){var t=e.getBBox();svg.removeChild(e),svg.appendChild(e),fillSVG(e,{opacity:1,width:t.width,height:t.height})}}}function makeDevice(e){var t={cons:{count:0},attach:{count:0}},n=newSVG("g"),r=newSVG("path");function o(e){var r=newSVG("g"),o=newSVG("path");fillSVG(o,{fill:e.color,stroke:"#111","stroke-width":"1",d:e.path}),r.appendChild(o),isSet(e.adornment)&&e.adornment(r);var i=newSVG("path");if(isSet(e.wire)){var a=isSet(e.wcolor)?e.wire.color:e.color;fillSVG(i,{fill:a,stroke:"#111","stroke-width":"0.5",opacity:0,d:e.wire.path}),r.appendChild(i)}for(var l={},d={},c=e.anchor,s=0;isSet(c[s]);s++)l[s]=newSVG("line"),fillSVG(l[s],{opacity:"0",stroke:"#111","stroke-width":"0",x1:c[s].x,y1:c[s].y,x2:c[s].x,y2:c[s].y}),r.appendChild(l[s]),void 0!=c[s].dx?(d[s]=newSVG("line"),fillSVG(d[s],{opacity:"0",stroke:"#111","stroke-width":"0",x1:c[s].dx,y1:c[s].dy,x2:c[s].dx,y2:c[s].dy}),r.appendChild(d[s])):d[s]=null;var u="translate("+e.x+","+e.y+")";switch(e.orient){case"S":u+=" rotate(180)";break;case"E":u+=" rotate(90)";break;case"W":u+=" rotate(270)"}fillSVG(r,{transform:u});var f={count:0,add:function(e){this[this.count++]=e}},v={opt:e,g:r,positions:function(){var t={},n=document.body.scrollLeft,o=document.body.scrollTop;for(var i in l){var a=l[i].getBoundingClientRect();if(null!=d[i]){r.appendChild(d[i]);var c=d[i].getBoundingClientRect();t[i]={x:a.left+n,y:a.top+o-20,dx:c.left+n,dy:c.top+o-20},r.removeChild(d[i])}else{c=e.anchor.calc(i,a);t[i]={x:a.left+n,y:a.top+o-20,dx:c.left+n,dy:c.top+o-20}}}return t},connect:function(e){fillSVG(i,{opacity:e?1:0})},addListener:function(e){f.add(e)},callListener:function(){for(var e=0;e<f.count;e++)f[e]()}};return t.cons[t.cons.count++]=v,n.appendChild(r),v}svg.appendChild(n),n.appendChild(r),n.style.cursor="move";var i=0,a=0,l=0,d={move:function(e,t){fillSVG(n,{transform:"translate("+(i=e)+","+(a=t)+") rotate("+l+")"}),this.callEvent()},rotate:function(e){fillSVG(n,{transform:"translate("+i+","+a+") rotate("+(l=e)+")"}),this.callEvent()},position:function(){return{x:i,y:a,a:l}},serialize:function(){return"x:"+i+";y:"+a+";a:"+l+";"},unserialize:function(e){var t;return null!=(t=e.match(/^x:([+-]?[0-9.]+);y:([+-]?[0-9.]+);a:([+-]?[0-9.]+);/))&&(i=parseFloat(t[1]),a=parseFloat(t[2]),l=parseFloat(t[3]),fillSVG(n,{transform:"translate("+i+","+a+") rotate("+l+")"}),this.callEvent(),!0)},select:function(e){fillSVG(r,{opacity:0==e?"0":"0.5"})},getBBox:function(){return n.getBBox()},addSVG:function(e){var t=newSVG(e);return n.appendChild(t),t},addConnector:function(e){try{return o(e)}catch(e){trace(1,"exception",e)}},addGroveCon:function(e){try{return function(e){var t={A:"#ee9",D:"#e99",I:"#99e",R:"#9e9",S:"#e95",W:"#eee"};void 0==t[e.es]&&(e.es="W");var n={color:t[e.es],wire:{},anchor:{},x:e.x,y:e.y,orient:e.orient};switch(e.type){case"D":n.path="m-10,-5 v10 h20 v-10 h-3 v2 h-14 v-2 z",n.wire.path="m-9,-4 v8 h18 v-8 h-1 v2 h-16 v-2 z",n.anchor={0:{x:6,y:1},1:{x:2,y:1},2:{x:-2,y:1},3:{x:-6,y:1},calc:function(e,t){return{left:t.left,top:t.top-50}}},n.adornment=function(e){for(var t=-6;t<=6;t+=4){var n=newSVG("line");fillSVG(n,{stroke:"#333","stroke-width":"1",x1:t,y1:1,x2:t,y2:2}),e.appendChild(n)}};break;case"P":default:n.path="m-10,-6 h5 v3 h10 v-3 h5 v13 h-20 z",n.wire.path="m-10,-6 h5 v3 h10 v-3 h5 v-7 h-20 z",n.anchor={0:{x:-6,y:-13,dx:-6,dy:-63},1:{x:-2,y:-13,dx:-2,dy:-63},2:{x:2,y:-13,dx:2,dy:-63},3:{x:6,y:-13,dx:6,dy:-63}},n.adornment=function(e){for(var t=-6;t<=6;t+=4){var n=newSVG("line");fillSVG(n,{stroke:"#333","stroke-width":"1",x1:t,y1:7,x2:t,y2:10}),e.appendChild(n)}}}return o(n)}(e)}catch(e){trace(1,"exception",e)}},addLedCon:function(e){try{return o({color:"#888",path:"m10,-7 v7 l-7,7 h-6 l-7,-7 v-7 z",wire:{color:"#8e8",path:"m10,-7 v-7 l-7,-7 h-6 l-7,7 v7 z"},anchor:{0:{x:2,y:-21,dx:2,dy:-71},1:{x:0,y:-21,dx:0,dy:-71},2:{x:-2,y:-21,dx:-2,dy:-71}},x:(t=e).x,y:t.y,orient:t.orient})}catch(e){trace(1,"exception",e)}var t},addBornCon:function(e){try{return o({color:"#1a1",path:"m-7,-3 h13 v7 h-13 z",anchor:{0:{x:-3,y:-3,dx:-3,dy:-53},1:{x:3,y:-3,dx:-3,dy:-53}},x:(t=e).x,y:t.y,orient:t.orient})}catch(e){trace(1,"exception",e)}var t},addMicroSwitch:function(e){try{var t=function(e){var t=newSVG("g"),n=newSVG("path");fillSVG(n,{fill:"#222",stroke:"#000","stroke-width":"1",d:"m"+-3*e.count+",6 v-12 h"+6*e.count+" v12 z"}),t.appendChild(n);for(var r={},o={},i=3*e.count-6,a=0;a<e.count;a++)r[a]=newSVG("path"),o[a]=newSVG("path"),fillSVG(r[a],{fill:"#eaa",stroke:"#888","stroke-width":"0.7",d:"m"+(i+1)+",-3 h4 v6 h-4 z"}),fillSVG(o[a],{fill:"#aea",stroke:"#888","stroke-width":"0.5",d:"m"+(i+1)+",0 h4 v3 h-4 z"}),t.appendChild(r[a]),t.appendChild(o[a]),i-=6;var l="translate("+e.x+","+e.y+")";switch(e.orient){case"S":l+=" rotate(180)";break;case"E":l+=" rotate(90)";break;case"W":l+=" rotate(270)"}return fillSVG(t,{transform:l}),{opt:e,g:t,set:function(t){for(var n=3*e.count-6,r=1,i=0;i<e.count;i++)fillSVG(o[i],0!=(t&r)?{d:"m"+(n+1)+",-3 h4 v3 h-4 z"}:{d:"m"+(n+1)+",0 h4 v3 h-4 z"}),n-=6,r*=2}}}(e);return n.appendChild(t.g),t}catch(e){trace(1,"exception",e)}},addCI:function(e){try{var t=function(e){var t,n=newSVG("g"),r=newSVG("path");switch(e.type){case"2x":t="m-"+(i=3*e.c)/4+",-"+i/2+" h"+i/2;for(var o=0;o<e.c;o++)t+=" v1.5 h2 h-2 v1.5";for(t+=" h-"+i/2,o=0;o<e.c;o++)t+=" v-1.5 h-2 h2 v-1.5";t+="z";break;case"4x":var i;for(t="m-"+(i=3*e.c)/2+",-"+i/2,o=0;o<e.c;o++)t+=" h1.5 v-2 v2 h1.5";for(o=0;o<e.c;o++)t+=" v1.5 h2 h-2 v1.5";for(o=0;o<e.c;o++)t+=" h-1.5 v2 v-2 h-1.5";for(o=0;o<e.c;o++)t+=" v-1.5 h-2 h2 v-1.5";t+="z"}fillSVG(r,{fill:"#222",stroke:"#555","stroke-width":"1",d:t}),n.appendChild(r);var a="translate("+e.x+","+e.y+")";switch(e.orient){case"E":a+=" rotate(90)";break;case"S":a+=" rotate(180)";break;case"W":a+=" rotate(270)"}return void 0!=e.scale&&(a+=" scale("+e.scale+")"),fillSVG(n,{transform:a}),{opt:e,g:n}}(e);return n.appendChild(t.g),t}catch(e){trace(1,"exception",e)}},addLabel:function(e,t){try{var r=newSVG("text");n.appendChild(r),r.appendChild(newText(e)),fillSVG(r,{fill:"#eee",x:t.x,y:t.y,"font-size":"11","font-family":"Monospace"}),t.color&&fillSVG(r,{fill:t.color});var o="";return t.rotate&&(o="rotate("+t.rotate+")"),t.scale&&(o+=" scale("+t.scale+")"),""!=o&&fillSVG(r,{transform:o}),r}catch(e){trace(1,"exception",e)}},callEvent:function(){for(var e=0;e<t.cons.count;e++)t.cons[e].callListener();for(e=0;e<t.attach.count;e++)t.attach[e]()},addEventListener:function(e,t){addEvent(n,e,t)},attach:function(e){t.attach[t.attach.count++]=e}};if(isSet(e.board)){var c=e.board.split(" ");switch(c[0]){case"Grove":n.appendChild(function(e,t,n){for(var o=newSVG("path"),i="m-"+31*e/2+",-"+31*t/2,a="c0,-5 7,-5",l="c0,5 7,5",d=0;d<e;d++)i+=" h12 "+(n?a:l)+" 7,0 h12",n=!n;for(a="c5,0 5,7",l="c-5,0 -5,7",d=0;d<t;d++)i+=" v12 "+(n?a:l)+" 0,7 v12",n=!n;for(a="c0,5 -7,5",l="c0,-5 -7,-5",d=0;d<e;d++)i+=" h-12 "+(n?a:l)+" -7,0 h-12",n=!n;for(a="c-5,0 -5,-7",l="c5,0 5,-7",d=0;d<t;d++)i+=" v-12 "+(n?a:l)+" 0,-7 v-12",n=!n;return fillSVG(o,{fill:"#22a",stroke:"#333","stroke-width":"1",d:i+=" z"}),fillSVG(r,{fill:"none",stroke:"#0ff","stroke-width":"4",d:i}),o}(parseInt(c[1]),parseInt(c[2]),"u"==c[3]));break;case"Direct":var s=void 0==e.bgcolor?"#22a":e.bgcolor,u=newSVG("path");fillSVG(u,{fill:s,stroke:"#333","stroke-width":"1",d:e.board.substr(7)}),fillSVG(r,{fill:"none",stroke:"#0ee","stroke-width":"4",d:e.board.substr(7)}),n.appendChild(u)}}return fillSVG(r,{opacity:"0"}),addEvent(n,"mousedown",function(e){return e.stopPropagation(),svg.removeChild(n),svg.appendChild(n),1==e.buttons?startMove(d):2==e.buttons&&startRotate(d),!1}),d}function newWire(e,t,n){t.connect(!0),n.connect(!0);var r={};for(var o in e)r[o]=newSVG("path"),svg.appendChild(r[o]),fillSVG(r[o],{fill:"none",stroke:e[o],"stroke-width":"2"});var i=function(){var e=t.positions(),o=n.positions();for(var i in r){var a="M"+e[i].x+","+e[i].y;a+=" C"+e[i].dx+","+e[i].dy,a+=" "+o[i].dx+","+o[i].dy,a+=" "+o[i].x+","+o[i].y,fillSVG(r[i],{d:a}),svg.removeChild(r[i]),svg.appendChild(r[i])}};t.addListener(i),n.addListener(i),i()}function newGroveWire(e,t){newWire({0:"#ee0",1:"#aaa",2:"#e00",3:"#111"},e,t)}function newTSLedWire(e,t){newWire({0:"#e00",1:"#0e0",2:"#111"},e,t)}function newGroveLED(e){var t=makeDevice({board:"Grove 1 1 u"});EnvData.addBubble(t,"Module LED");var n=t.addGroveCon({type:"D",es:"D",orient:"E",x:-8,y:0}),r=t.addSVG("circle"),o="#f00",i="#500";isSet(e)&&(o=intToCol(e),i=intToColLow(e,3));return fillSVG(r,{fill:i,stroke:"#000","stroke-width":"0.3",cx:"8",cy:"8",r:"6"}),{element:t,connector:n,set:function(e){e,fillSVG(r,{fill:e?o:i})},reinit:function(){this.set(!1)},placing:function(e){t.move(e.x,e.y),t.rotate(e.a)}}}function newGroveButton(e){var t=makeDevice({board:"Grove 1 1 u"});EnvData.addBubble(t,"Module Button");var n=t.addGroveCon({type:"D",es:"D",orient:"E",x:-8,y:0}),r=t.addSVG("path"),o=t.addSVG("circle");return fillSVG(r,{fill:"#aaa",stroke:"#000","stroke-width":"0.7",d:"M1,5 h10 v-10 h-10 z"}),fillSVG(o,{fill:"#666",stroke:"#000","stroke-width":"0.3",cx:"6",cy:"0",r:"3"}),addEvent(o,"mousedown",function(t){t.stopPropagation(),dataUpdate(e,1)}),addEvent(o,"mouseup",function(t){t.stopPropagation(),dataUpdate(e,0)}),o.style.cursor="pointer",{element:t,connector:n,reinit:function(){},placing:function(e){t.move(e.x,e.y),t.rotate(e.a)}}}function newGroveBuzzer(){var e=null,t=makeDevice({board:"Grove 1 1 u"});EnvData.addBubble(t,"Module Buzzer");var n=t.addGroveCon({type:"D",es:"D",orient:"E",x:-8,y:0}),r=t.addSVG("circle"),o=t.addSVG("circle"),i=t.addLabel("Buz",{color:"#CCC",x:2,y:-2,scale:.7,opacity:0});return fillSVG(r,{fill:"#111",stroke:"#000","stroke-width":"0.3",cx:"6",cy:"0",r:"6"}),fillSVG(o,{fill:"#AAA",stroke:"#000","stroke-width":"0.3",cx:"6",cy:"0",r:"2"}),{element:t,connector:n,tone:function(){null==e&&null!=(e=newAudio())&&(e.src="https://technoblin.github.io/ext4scratchX/lib/buzzer.mp3",e.loop=!0),null!=e&&e.play(),fillSVG(i,{opacity:.8})},notone:function(){null!=e&&e.pause(),fillSVG(i,{opacity:0})},set:function(e){e?this.tone():this.notone()},reinit:function(){null!=e&&e.pause()},placing:function(e){t.move(e.x,e.y),t.rotate(e.a)}}}function newGroveRelay(){var e=makeDevice({board:"Grove 2 1 u"});EnvData.addBubble(e,"Module Relay");var t=e.addGroveCon({type:"D",es:"D",orient:"E",x:-24,y:0}),n=e.addSVG("path");e.addBornCon({orient:"S",x:-10,y:8});fillSVG(n,{fill:"#333",stroke:"#000","stroke-width":"1",d:"m0,-10 h27 v20 h-27 z"});return{element:e,connector:t,set:function(e){e},reinit:function(){this.set(!1)},placing:function(t){e.move(t.x,t.y),e.rotate(t.a)}}}function newGroveChainableRGBLed(e){var t=makeDevice({board:"Grove 2 1 u"});EnvData.addBubble(t,"Module Chainable RGB LED");var n=t.addGroveCon({type:"P",es:"D",orient:"W",x:-25,y:0}),r=t.addGroveCon({type:"P",es:"D",orient:"E",x:25,y:0}),o=t.addSVG("circle"),i=t.addSVG("circle");fillSVG(o,{fill:"#ccc",stroke:"#000","stroke-width":"0.3",cx:"0",cy:"0",r:"8"}),fillSVG(i,{fill:"#000",stroke:"none",cx:"0",cy:"0",r:"9",opacity:0});var a={isChainable:!0,element:t,connector:n,set:function(e,t){e<=0?fillSVG(i,{fill:intToCol(t),opacity:alpha(t)}):void 0!=this.next&&this.next.set(e-1,t)},reinit:function(){this.set(0,0)},placing:function(e){t.move(e.x,e.y),t.rotate(e.a),void 0!=this.next&&(e.x+=Math.floor(90*Math.cos(e.a*Math.PI/180)),e.y+=Math.floor(90*Math.sin(e.a*Math.PI/180)),this.next.placing(e)),resizeCaneva()}};return e>1&&(a.next=newGroveChainableRGBLed(e-1),newGroveWire(r,a.next.connector)),t.__serialize=t.serialize,t.serialize=function(){return this.__serialize()+(void 0!=a.next?a.next.element.serialize():"")},t.__unserialize=t.unserialize,t.unserialize=function(e){var t;return null!=(t=e.match(/^x:([+-]?[0-9.]+);y:([+-]?[0-9.]+);a:([+-]?[0-9.]+);(.*)/))&&(this.__unserialize(e),void 0!=a.next)&&a.next.element.unserialize(t[4])},a}function newGroveLedBar(){var e=makeDevice({board:"Grove 2 1 d"});EnvData.addBubble(e,"Module LED bar");var t=e.addGroveCon({type:"P",es:"D",orient:"W",x:-25,y:0});fillSVG(e.addSVG("rect"),{fill:"#111",stroke:"#000","stroke-width":"0.3",x:"-10",y:"-8",width:"40",height:"16"});for(var n={},r=1;r<=10;r++)n[r]=e.addSVG("rect"),fillSVG(n[r],{fill:"#666",stroke:"#000","stroke-width":"0.3",x:4*r-13,y:"-6",width:"3",height:"12"});var o=!0,i=!1;return{isLedBar:!0,element:e,connector:t,set:function(e,t){i&&this.clear(),o||(e=11-e),fillSVG(n[e],0==t?{fill:"#666"}:1==e?{fill:"#f33"}:2==e?{fill:"#ff3"}:{fill:"#3f3"})},conf:function(e){switch(e){case"clear":case"full":for(var t=1;t<=10;t++)this.set(t,"full"==e?1:0);break;case"redFirst":o=!0,i=!0;break;case"redLast":o=!1,i=!0}},clear:function(){i=!1;for(var e=1;e<=10;e++)this.set(e,0)},placing:function(t){e.move(t.x,t.y),e.rotate(t.a),resizeCaneva()}}}function newGrove4digit(){var e=makeDevice({board:"Grove 2 1 d"});EnvData.addBubble(e,"Module 4 digits display");var t=e.addGroveCon({type:"P",es:"D",orient:"W",x:-25,y:0});fillSVG(e.addSVG("rect"),{fill:"#111",stroke:"#000","stroke-width":"0.3",x:"-27",y:"-13",width:"64",height:"25"});for(var n={},r={1:{x:-13,d:"-11 h8 l1,1 l-2,2 h-6 l-2,-2"},2:{x:-3,d:"-9 v8 l-1,1 l-2,-2 v-6 l2,-2"},3:{x:-3,d:"0 v8 l-1,1 l-2,-2 v-6 l2,-2"},4:{x:-12,d:"7 h6 l2,2 l-1,1 h-8 l-1,-1"},5:{x:-14,d:"9 l2,-2 v-6 l-2,-2 l-1,1 v8"},6:{x:-14,d:"0 l2,-2 v-6 l-2,-2 l-1,1 v8"},0:{x:-13.5,d:"0 l1.5,-1.5 h6 l1.5,1.5 l-1.5,1.5 h-6"}},o={0:"1111110",1:"0110000",2:"1101101",3:"1111001",4:"0110011",5:"1011011",6:"1011111",7:"1110000",8:"1111111",9:"1111011",a:"1110111",A:"1110111",b:"0011111",B:"0011111",c:"1001110",C:"1001110",d:"0111101",D:"0111101",e:"1001111",E:"1001111",f:"1000111",F:"1000111"},i=0,a=1;a<=28;a++)n[a]=e.addSVG("path"),fillSVG(n[a],{fill:"#333",stroke:"#000","stroke-width":"0.3",d:"m"+(r[a%7].x+(16*i-10))+","+r[a%7].d+" z"}),a%7==0&&i++;n[29]=e.addSVG("circle"),fillSVG(n[29],{fill:"#333",stroke:"#000","stroke-width":"0.3",cx:5,cy:-4,r:1.5}),n[30]=e.addSVG("circle"),fillSVG(n[30],{fill:"#333",stroke:"#000","stroke-width":"0.3",cx:5,cy:4,r:1.5});return{isDigitDisp:!0,element:e,connector:t,set:function(e,t){void 0!=n[e]&&fillSVG(n[e],{fill:t?"#f33":"#333"})},aff:function(e){for(var t=0;t<5;t++)if(void 0!=e[t])if(2==t)switch(e[t]){case":":fillSVG(n[29],{fill:"#f33"}),fillSVG(n[30],{fill:"#f33"});break;case".":fillSVG(n[29],{fill:"#333"}),fillSVG(n[30],{fill:"#f33"});break;case"'":fillSVG(n[29],{fill:"#f33"}),fillSVG(n[30],{fill:"#333"});break;default:fillSVG(n[29],{fill:"#333"}),fillSVG(n[30],{fill:"#333"})}else if(void 0!=o[e[t]])for(var r=t<2?t:t-1,i=0;i<7;i++)fillSVG(n[7*r+i+1],{fill:"0"==o[e[t]][i]?"#333":"#f33"});else for(r=t<2?t:t-1,i=0;i<7;i++)fillSVG(n[7*r+i+1],{fill:"#333"})},clear:function(){for(var e=1;e<=30;e++)fillSVG(n[e],{fill:"#333"})},placing:function(t){e.move(t.x,t.y),e.rotate(t.a),resizeCaneva()}}}function newGroveUltrasonic(e){var t=makeDevice({bgcolor:"#22a",board:"Direct m0,-20.5 h40.75 q3,0 3,3 v35 q0,3 -3,3 h-81.5 q-3,0 -3,-3 v-35 q0,-3 3,-3 z"});EnvData.addBubble(t,"Module Ultrasonic Ranger");var n=t.addGroveCon({type:"D",es:"D",orient:"N",x:0,y:-19.5}),r=t.addSVG("circle"),o=t.addSVG("circle"),i=t.addSVG("circle"),a=t.addSVG("circle");fillSVG(r,{fill:"#aaa",stroke:"#000","stroke-width":"0.7",cx:"-20.5",cy:"0",r:"16"}),fillSVG(o,{fill:"#111",stroke:"#000","stroke-width":"0.7",cx:"-20.5",cy:"0",r:"10"}),fillSVG(i,{fill:"#aaa",stroke:"#000","stroke-width":"0.7",cx:"20.5",cy:"0",r:"16"}),fillSVG(a,{fill:"#111",stroke:"#000","stroke-width":"0.7",cx:"20.5",cy:"0",r:"10"});var l=newFormular();return l.addLabel("Distance :"),l.addSlidebar(1,30,30,function(t){dataUpdate(e,t)}),l.hide(),t.attach(function(){l.hide()}),addEventClick(t,null,function(){var e=t.position();l.move(e.x,e.y),l.show()}),{element:t,connector:n,reinit:function(){},placing:function(e){t.move(e.x,e.y),t.rotate(e.a)}}}function newGroveDHT(e){var t=makeDevice({board:"Grove 1 1 u"});EnvData.addBubble(t,"Module Digital HT");var n=t.addGroveCon({type:"D",es:"D",orient:"E",x:-8,y:0}),r=t.addSVG("path"),o=t.addSVG("circle");return fillSVG(r,{fill:"#aaa",stroke:"#000","stroke-width":"0.7",d:"M1,5 h10 v-10 h-10 z"}),fillSVG(o,{fill:"#666",stroke:"#000","stroke-width":"0.3",cx:"6",cy:"0",r:"3"}),addEvent(o,"mousedown",function(t){t.stopPropagation(),dataUpdate(e,1)}),addEvent(o,"mouseup",function(t){t.stopPropagation(),dataUpdate(e,0)}),o.style.cursor="pointer",{element:t,connector:n,reinit:function(){},placing:function(e){t.move(e.x,e.y),t.rotate(e.a)}}}function newGrovePIR(e){var t=makeDevice({board:"Grove 2 1 u"});EnvData.addBubble(t,"Module PIR Motion");var n=t.addGroveCon({type:"D",es:"D",orient:"E",x:-24,y:0}),r=t.addSVG("circle"),o=t.addSVG("circle");fillSVG(r,{fill:"#eee",stroke:"#111","stroke-width":"0.3",cx:"12",cy:"0",r:"9"}),fillSVG(o,{fill:"#e00",stroke:"#300","stroke-width":"0.3",cx:"12",cy:"0",r:"24",opacity:"0.1"});var i=!1,a=function(){dataUpdate(e,1),setTimeout(function(){dataUpdate(e,0)},1e3)},l=null,d=0;return EnvData.addMouseMove(function(e){i&&a()}),addEvent(o,"mouseover",function(){a(),i=!0,null!=l&&clearInterval(l),l=setInterval(function(){fillSVG(o,1==(d=1-d)?{opacity:"0.3"}:{opacity:"0.1"})},500)}),addEvent(o,"mouseout",function(){i=!1,clearInterval(l),l=null,fillSVG(o,{opacity:"0.1"})}),{element:t,connector:n,reinit:function(){},placing:function(e){t.move(e.x,e.y),t.rotate(e.a)}}}function newGroveButton(e){var t=makeDevice({board:"Grove 1 1 u"});EnvData.addBubble(t,"Module IR Line Finder");var n=t.addGroveCon({type:"D",es:"D",orient:"E",x:-8,y:0}),r=t.addSVG("path"),o=t.addSVG("circle");return fillSVG(r,{fill:"#aaa",stroke:"#000","stroke-width":"0.7",d:"M1,5 h10 v-10 h-10 z"}),fillSVG(o,{fill:"#666",stroke:"#000","stroke-width":"0.3",cx:"6",cy:"0",r:"3"}),addEvent(o,"mousedown",function(t){t.stopPropagation(),dataUpdate(e,1)}),addEvent(o,"mouseup",function(t){t.stopPropagation(),dataUpdate(e,0)}),o.style.cursor="pointer",{element:t,connector:n,reinit:function(){},placing:function(e){t.move(e.x,e.y),t.rotate(e.a)}}}function newGroveI2Chub(){var e=makeDevice({board:"Grove 2 1 d"});EnvData.addBubble(e,"Module I2C hub");var t={0:e.addGroveCon({type:"D",es:"I",orient:"W",x:-24,y:0}),1:e.addGroveCon({type:"D",es:"I",orient:"W",x:-8,y:0}),2:e.addGroveCon({type:"D",es:"I",orient:"W",x:8,y:0}),3:e.addGroveCon({type:"D",es:"I",orient:"W",x:24,y:0})};return{element:e,connector:t,reinit:function(){},placing:function(t){e.move(t.x,t.y),e.rotate(t.a)}}}function newGroveGPS(e){var t=makeDevice({board:"Grove 2 1 u"});EnvData.addBubble(t,"Module Grove GPS");var n=t.addGroveCon({type:"D",es:"R",orient:"E",x:-24,y:0}),r=t.addSVG("path"),o=t.addSVG("path");fillSVG(r,{fill:"none",stroke:"#000","stroke-width":"1",d:"m26,-12 q20,0 0,20"}),fillSVG(o,{fill:"#ddd",stroke:"#000","stroke-width":"1",d:"m16,2 h20 v20 h-20 z"}),addEvent(o,"click",function(){clear(formular),formular.appendChild(form)});var i=newFormular();return i.addLabel("Latitude :"),i.addInput(0,function(t){dataUpdate(e,t)}),i.addLabel("Longitude :"),i.addInput(0,function(t){dataUpdate(e,t)}),i.hide(),t.attach(function(){i.hide()}),addEventClick(t,null,function(){var e=t.position();i.move(e.x,e.y),i.show()}),setInterval(function(){dataUpdate(e,"GPS:0:0:0:0")},1e3),{element:t,connector:n,reinit:function(){},placing:function(e){t.move(e.x,e.y),t.rotate(e.a)}}}svg.appendChild(select_box),fillSVG(select_box,{fill:"none",stroke:"#000","stroke-width":"0.3",opacity:"0"}),addEvent(document,"mousedown",function(e){var t=EnvData.souris(svg,!0);select_pos={x:t.x,y:t.y},fillSVG(select_box,{opacity:"1",x:t.x,y:t.y,width:1,height:1})}),addEvent(document.body,"mouseup",function(e){fillSVG(select_box,{opacity:"0"}),select_pos=null,stopDrop()}),EnvData.addMouseMove(function(e){if(null!=select_pos){var t,n,r=EnvData.souris(svg,!0),o=r.x-select_pos.x,i=r.y-select_pos.y;o<0?(t=r.x,o=-o):t=select_pos.x,i<0?(n=r.y,i=-i):n=select_pos.y,fillSVG(select_box,{x:t,y:n,width:o,height:i}),resizeCaneva()}});var policeOled={0:[0,126,66,66,66,66,126,0],31:[0,20,62,85,85,65,0,0],32:[0,0,0,0,0,0,0,0],33:[0,0,95,0,0,0,0,0],34:[0,0,7,0,7,0,0,0],35:[0,20,127,20,127,20,0,0],36:[0,36,42,127,42,18,0,0],37:[0,35,19,8,100,98,0,0],38:[0,54,73,85,34,80,0,0],39:[0,0,5,3,0,0,0,0],40:[0,28,34,65,0,0,0,0],41:[0,65,34,28,0,0,0,0],42:[0,8,42,28,42,8,0,0],43:[0,8,8,62,8,8,0,0],44:[0,160,96,0,0,0,0,0],45:[0,8,8,8,8,8,0,0],46:[0,96,96,0,0,0,0,0],47:[0,32,16,8,4,2,0,0],48:[0,62,81,73,69,62,0,0],49:[0,0,66,127,64,0,0,0],50:[0,98,81,73,73,70,0,0],51:[0,34,65,73,73,54,0,0],52:[0,24,20,18,127,16,0,0],53:[0,39,69,69,69,57,0,0],54:[0,60,74,73,73,48,0,0],55:[0,1,113,9,5,3,0,0],56:[0,54,73,73,73,54,0,0],57:[0,6,73,73,41,30,0,0],58:[0,0,54,54,0,0,0,0],59:[0,0,172,108,0,0,0,0],60:[0,8,20,34,65,0,0,0],61:[0,20,20,20,20,20,0,0],62:[0,65,34,20,8,0,0,0],63:[0,2,1,81,9,6,0,0],64:[0,50,73,121,65,62,0,0],65:[0,126,9,9,9,126,0,0],66:[0,127,73,73,73,54,0,0],67:[0,62,65,65,65,34,0,0],68:[0,127,65,65,34,28,0,0],69:[0,127,73,73,73,65,0,0],70:[0,127,9,9,9,1,0,0],71:[0,62,65,65,81,114,0,0],72:[0,127,8,8,8,127,0,0],73:[0,65,127,65,0,0,0,0],74:[0,32,64,65,63,1,0,0],75:[0,127,8,20,34,65,0,0],76:[0,127,64,64,64,64,0,0],77:[0,127,2,12,2,127,0,0],78:[0,127,4,8,16,127,0,0],79:[0,62,65,65,65,62,0,0],80:[0,127,9,9,9,6,0,0],81:[0,62,65,81,33,94,0,0],82:[0,127,9,25,41,70,0,0],83:[0,38,73,73,73,50,0,0],84:[0,1,1,127,1,1,0,0],85:[0,63,64,64,64,63,0,0],86:[0,31,32,64,32,31,0,0],87:[0,63,64,56,64,63,0,0],88:[0,99,20,8,20,99,0,0],89:[0,3,4,120,4,3,0,0],90:[0,97,81,73,69,67,0,0],91:[0,127,65,65,0,0,0,0],92:[0,2,4,8,16,32,0,0],93:[0,65,65,127,0,0,0,0],94:[0,4,2,1,2,4,0,0],95:[0,128,128,128,128,128,0,0],96:[0,1,2,4,0,0,0,0],97:[0,32,84,84,84,120,0,0],98:[0,127,72,68,68,56,0,0],99:[0,56,68,68,40,0,0,0],100:[0,56,68,68,72,127,0,0],101:[0,56,84,84,84,24,0,0],102:[0,8,126,9,2,0,0,0],103:[0,24,164,164,164,124,0,0],104:[0,127,8,4,4,120,0,0],105:[0,0,125,0,0,0,0,0],106:[0,128,132,125,0,0,0,0],107:[0,127,16,40,68,0,0,0],108:[0,65,127,64,0,0,0,0],109:[0,124,4,24,4,120,0,0],110:[0,124,8,4,124,0,0,0],111:[0,56,68,68,56,0,0,0],112:[0,252,36,36,24,0,0,0],113:[0,24,36,36,252,0,0,0],114:[0,0,124,8,4,0,0,0],115:[0,72,84,84,36,0,0,0],116:[0,4,127,68,0,0,0,0],117:[0,60,64,64,124,0,0,0],118:[0,28,32,64,32,28,0,0],119:[0,60,64,48,64,60,0,0],120:[0,68,40,16,40,68,0,0],121:[0,28,160,160,124,0,0,0],122:[0,68,100,84,76,68,0,0],123:[0,8,54,65,0,0,0,0],124:[0,0,127,0,0,0,0,0],125:[0,65,54,8,0,0,0,0],126:[0,2,1,1,2,1,0,0],127:[0,2,5,5,2,0,0,0],169:[0,60,90,102,102,66,60,0],224:[0,32,85,86,86,120,0,0],225:[0,32,86,86,85,120,0,0],226:[0,32,86,85,86,120,0,0],227:[0,32,86,85,86,121,0,0],228:[0,32,85,84,85,120,0,0],229:[0,32,84,87,87,120,0,0],230:[0,36,84,120,84,88,0,0],231:[0,28,162,98,20,0,0,0],232:[0,56,85,86,86,24,0,0],233:[0,56,86,86,85,24,0,0],234:[0,56,86,85,86,24,0,0],235:[0,56,85,84,85,24,0,0],236:[0,1,122,4,0,0,0,0],237:[0,4,122,1,0,0,0,0],238:[0,2,121,2,0,0,0,0],239:[0,1,125,1,0,0,0,0],240:[0,48,76,75,74,61,0,0],241:[0,122,17,10,113,0,0,0],242:[0,56,69,70,56,0,0,0],243:[0,56,70,69,56,0,0,0],244:[0,58,69,70,56,0,0,0],245:[0,58,69,70,57,0,0,0],246:[0,57,69,69,57,0,0,0],247:[0,16,16,84,16,16,0,0],248:[0,88,36,84,72,52,0,0],249:[0,56,65,66,120,0,0,0],250:[0,56,66,65,120,0,0,0],251:[0,58,65,66,120,0,0,0],252:[0,58,64,66,120,0,0,0],G0:[0,0,0,255,0,0,0,0],G1:[8,8,8,255,0,0,0,0],G2:[36,36,36,255,0,0,0,0],G3:[8,8,255,0,0,255,0,0],G4:[8,8,248,8,8,248,0,0],G5:[36,36,36,252,0,0,0,0],G6:[36,36,231,0,0,255,0,0],G7:[0,0,255,0,0,255,0,0],G8:[0,0,255,0,0,255,0,0],G9:[36,36,228,4,4,252,0,0],GA:[36,36,39,32,32,63,0,0],GB:[8,8,15,8,8,15,0,0],GC:[36,36,36,8,0,0,0,0],GD:[8,8,8,248,0,0,0,0],GE:[0,0,0,15,8,8,8,8],GF:[8,8,8,15,8,8,8,8],GG:[8,8,8,248,8,8,8,8],GH:[0,0,0,255,8,8,8,8],GI:[8,8,8,8,8,8,8,8],GJ:[8,8,8,255,8,8,8,8],GK:[0,0,0,255,36,36,36,36],GL:[0,0,255,0,0,255,8,8]};function newGroveOLEDgeneric(e,t,n){var r={},o=e.addSVG("g"),i=newSVG("rect");fillSVG(i,{fill:"#111",stroke:"#111","stroke-width":"1",x:"-1",y:"-1",width:t+2,height:n+2}),o.appendChild(i);for(var a=0;a<t;a++)for(var l=0;l<n;l++){var d=newSVG("rect");o.appendChild(d),fillSVG(d,{fill:"#fff",stroke:"none",x:a,y:l,width:1,height:1,opacity:"0.1"}),r[a+";"+l]=d}return o.setBackground=function(e){fillSVG(i,{fill:e})},o.setPoint=function(e,t,n){void 0!=r[e+";"+t]&&fillSVG(r[e+";"+t],{opacity:n})},o}function newGroveOLED128x64(){var e=makeDevice({board:"Grove 2 1 d"});EnvData.addBubble(e,"Module oLed display 128x64");var t=e.addGroveCon({type:"P",es:"I",orient:"W",x:-25,y:0}),n=newGroveOLEDgeneric(e,128,64);fillSVG(n,{transform:"translate(-15, -12) scale(0.35, 0.35)"}),addEvent(n,"mouseover",function(){fillSVG(n,{transform:"translate(-15, -32) scale(1, 1)"}),resizeCaneva()}),addEvent(n,"mouseout",function(){fillSVG(n,{transform:"translate(-15, -12) scale(0.35, 0.35)"})});var r=0,o=0;return{element:e,connector:t,reinit:function(){n.setBackground("#373"),this.clear()},setBrightness:function(e){e<25?n.setBackground("#373"):e<50?n.setBackground("#494"):e<75?n.setBackground("#5D5"):n.setBackground("#6E6")},gotoXY:function(e,t){r=e,o=t},clear:function(){for(var e=0;e<8;e++){this.gotoXY(0,e);for(var t=0;t<16;t++)this.putChar(" ")}},putChar:function(e){for(var t=this.font(e),i=0;i<8;i++)for(var a=0;a<8;a++)n.setPoint(8*r+i,8*o+a,1==(t[i]>>a&1)?"0.9":"0.1");r++},font:function(e){var t=e.charCodeAt(0);return void 0==policeOled[t]&&(t=0),policeOled[t]},print:function(e){e=decodeText(e),console.log("oLED.print("+e+")");for(var t=0;t<e.length;t++)this.putChar(e[t])},placing:function(t){e.move(t.x,t.y),e.rotate(t.a)}}}function newGroveOLED96x96(){var e=makeDevice({board:"Grove 2 2 d"});EnvData.addBubble(e,"Module oLed display 96x96");var t=e.addGroveCon({type:"P",es:"I",orient:"W",x:-25,y:0}),n=newGroveOLEDgeneric(e,96,96);fillSVG(n,{transform:"translate(-15, -20) scale(0.48, 0.48)"}),addEvent(n,"mouseover",function(){fillSVG(n,{transform:"translate(-15, -48) scale(1, 1)"});var e=svg.getBBox();fillSVG(svg,{width:e.x+e.width+10,height:e.y+e.height+10})}),addEvent(n,"mouseout",function(){fillSVG(n,{transform:"translate(-15, -20) scale(0.48, 0.48)"})});var r=0,o=0;return{element:e,connector:t,reinit:function(){n.setBackground("#373"),this.clear()},setBrightness:function(e){e<25?n.setBackground("#373"):e<50?n.setBackground("#494"):e<75?n.setBackground("#5D5"):n.setBackground("#6E6")},gotoXY:function(e,t){r=e,o=t},clear:function(){for(var e=0;e<8;e++){this.gotoXY(0,e);for(var t=0;t<16;t++)this.putChar(" ")}},putChar:function(e){for(var t=this.font(e),i=0;i<8;i++)for(var a=0;a<8;a++)n.setPoint(8*r+i,8*o+a,1==(t[i]>>a&1)?"0.9":"0.1");r++},font:function(e){var t=e.charCodeAt(0);return void 0==policeOled[t]&&(t=0),policeOled[t]},print:function(e){e=decodeText(e),console.log("oLED.print("+e+")");for(var t=0;t<e.length;t++)this.putChar(e[t])},placing:function(t){e.move(t.x,t.y),e.rotate(t.a)}}}function newGroveOLED128x128(){var e=makeDevice({board:"Grove 2 2 d"});EnvData.addBubble(e,"Module oLed display 128x128");var t=e.addGroveCon({type:"P",es:"I",orient:"W",x:-25,y:0}),n=newGroveOLEDgeneric(e,128,128);fillSVG(n,{transform:"translate(-16, -22) scale(0.36, 0.36)"}),addEvent(n,"mouseover",function(){fillSVG(n,{transform:"translate(-15, -48) scale(1, 1)"});var e=svg.getBBox();fillSVG(svg,{width:e.x+e.width+10,height:e.y+e.height+10})}),addEvent(n,"mouseout",function(){fillSVG(n,{transform:"translate(-16, -22) scale(0.36, 0.36)"})});var r=0,o=0;return{element:e,connector:t,reinit:function(){n.setBackground("#373"),this.clear()},setBrightness:function(e){e<25?n.setBackground("#373"):e<50?n.setBackground("#494"):e<75?n.setBackground("#5D5"):n.setBackground("#6E6")},gotoXY:function(e,t){r=e,o=t},clear:function(){for(var e=0;e<16;e++){this.gotoXY(0,e);for(var t=0;t<16;t++)this.putChar(" ")}},putChar:function(e){for(var t=this.font(e),i=0;i<8;i++)for(var a=0;a<8;a++)n.setPoint(8*r+i,8*o+a,1==(t[i]>>a&1)?"0.9":"0.1");r++},font:function(e){var t=e.charCodeAt(0);return void 0==policeOled[t]&&(t=0),policeOled[t]},print:function(e){e=decodeText(e),console.log("oLED.print("+e+")");for(var t=0;t<e.length;t++)this.putChar(e[t])},placing:function(t){e.move(t.x,t.y),e.rotate(t.a)}}}function newGroveLCDRGBBacklight(){var e=makeDevice({board:"Grove 4 2 d"});EnvData.addBubble(e,"Module LCD RGB Backlight");var t=e.addGroveCon({type:"P",es:"I",orient:"W",x:-30,y:18}),n=e.addSVG("path"),r=e.addSVG("path"),o=e.addSVG("path"),i=e.addSVG("text"),a=e.addSVG("text");return fillSVG(n,{fill:"#111",stroke:"#000","stroke-width":"1",d:"m-58,-27 h116 v32 h-116 z"}),fillSVG(r,{fill:"#363",stroke:"none","stroke-width":"0",d:"m-56,-23 h112 v24 h-112 z"}),fillSVG(o,{fill:"#000",opacity:"0",stroke:"none","stroke-width":"0",d:"m-56,-23 h112 v24 h-112 z"}),fillSVG(i,{fill:"#000",x:"-56",y:"-13","font-size":"11","font-family":"Monospace"}),fillSVG(a,{fill:"#000",x:"-56",y:"-1","font-size":"11","font-family":"Monospace"}),{element:e,connector:t,reinit:function(){this.setColor(0),this.clear()},setColor:function(e){fillSVG(o,{fill:intToCol(e),opacity:alpha(e)})},print:function(e,t){e=decodeText(e),t=decodeText(t),clear(i),clear(a),i.appendChild(newText(e.substr(0,16))),a.appendChild(newText(t.substr(0,16)))},clear:function(){clear(i),clear(a)},call:function(e){switch(e[0]){case"print":this.print(e[1],e[2]);break;case"color":this.setColor(e[1]);break;case"set":switch(e[1]){case"1":this.clear()}}},placing:function(t){e.move(t.x,t.y),e.rotate(t.a)}}}function newGroveMotorDriver(e){var t=makeDevice({board:"Grove 3 2 d"});EnvData.addBubble(t,"Module i2c step motor driver");var n=t.addGroveCon({type:"D",es:"I",orient:"W",x:-36,y:0}),r={in:t.addBornCon({orient:"W",x:-35,y:18}),m1:t.addBornCon({orient:"E",x:35,y:-18}),m2:t.addBornCon({orient:"E",x:35,y:18})},o=newStepperMotor();return newWire({0:"#ee0",1:"#0e0"},r.m1,o.connector[0]),newWire({0:"#e00",1:"#aaa"},r.m2,o.connector[1]),t.addMicroSwitch({orient:"S",x:-12,y:-18,count:4}).set(e),{element:t,connector:n,reinit:function(){},placing:function(e){t.move(e.x,e.y),t.rotate(e.a),o.placing({x:e.x+90,y:e.y+11,a:0})}}}function newRotorCross(e){var t=newSVG("path");fillSVG(t,{fill:"#333",stroke:"#333","stroke-width":"0",d:"m3,-3 h4 v2 c-1.5,0 -1.5,2 0,2 c1.5,0 1.5,-2 0,-2 v-2 h3 v2 c-1.5,0 -1.5,2 0,2 c1.5,0 1.5,-2 0,-2 v-2 h3 v2 c-1.5,0 -1.5,2 0,2 c1.5,0 1.5,-2 0,-2 v-2 c6,0 6,6 0,6 h-10 v10 c0,6 -6,6 -6,0 h2 c0,1.5 2,1.5 2,0 c0,-1.5 -2,-1.5 -2,0 h-2 v-3 h2 c0,1.5 2,1.5 2,0 c0,-1.5 -2,-1.5 -2,0 h-2 v-3 h2 c0,1.5 2,1.5 2,0 c0,-1.5 -2,-1.5 -2,0 h-2 v-4 h-10 c-6,0 -6,-6 0,-6 v2 c-1.5,0 -1.5,2 0,2 c1.5,0 1.5,-2 0,-2 v-2 h3 v2 c-1.5,0 -1.5,2 0,2 c1.5,0 1.5,-2 0,-2 v-2 h3 v2 c-1.5,0 -1.5,2 0,2 c1.5,0 1.5,-2 0,-2 v-2 h4 v-4 h2 c0,1.5 2,1.5 2,0 c0,-1.5 -2,-1.5 -2,0 h-2 v-3 h2 c0,1.5 2,1.5 2,0 c0,-1.5 -2,-1.5 -2,0 h-2 v-3 h2 c0,1.5 2,1.5 2,0 c0,-1.5 -2,-1.5 -2,0 h-2 c0,-6 6,-6 6,0 z"}),e.appendChild(t);var n=newSVG("path");fillSVG(n,{fill:"none",stroke:"#111","stroke-width":"1",d:"m3,-3 h10 c6,0 6,6 0,6 h-10 v10 c0,6 -6,6 -6,0 v-10  h-10 c-6,0 -6,-6 0,-6 h10 v-10 c0,-6 6,-6 6,0 z"}),e.appendChild(n)}function newStepperMotor(){var e=makeDevice({bgcolor:"#aaa",board:"Direct m18,18 h-36 v-36 h36 z"});EnvData.addBubble(e,"step motor");var t={0:e.addConnector({color:"none",path:"m3,0 h-6 z",anchor:{0:{x:3,y:0,dx:3,dy:-50},1:{x:1,y:0,dx:1,dy:-50}},x:0,y:-18,orient:"N"}),1:e.addConnector({color:"none",path:"m3,0 h-6 z",anchor:{0:{x:-1,y:0,dx:-1,dy:-50},1:{x:-3,y:0,dx:-3,dy:-50}},x:0,y:-18,orient:"N"})},n=e.addSVG("g");newRotorCross(n),fillSVG(n,{transform:"rotate(0)"});var r=0;return{element:e,connector:t,reinit:function(){},placing:function(t){e.move(t.x,t.y),e.rotate(t.a)},move:function(e){for(r+=e;r<0;)r+=400;fillSVG(n,{transform:"rotate("+360*(r%=400)/400+")"})}}}function newGrovePi(){var e=makeDevice({board:"Direct m-72,-50 h145 v100 h-130 q-15,0 -15,-15 z"});EnvData.addBubble(e,"Shield GrovePi+");var t={D2:e.addGroveCon({type:"P",es:"D",orient:"S",x:3,y:44}),D3:e.addGroveCon({type:"P",es:"D",orient:"S",x:36,y:44}),D4:e.addGroveCon({type:"P",es:"D",orient:"S",x:61,y:44}),D5:e.addGroveCon({type:"D",es:"D",orient:"W",x:36,y:-14}),D6:e.addGroveCon({type:"D",es:"D",orient:"W",x:36,y:11}),D7:e.addGroveCon({type:"P",es:"D",orient:"N",x:3,y:-44}),D8:e.addGroveCon({type:"P",es:"D",orient:"N",x:36,y:-44}),A0:e.addGroveCon({type:"P",es:"A",orient:"W",x:-66,y:-28}),A1:e.addGroveCon({type:"P",es:"A",orient:"W",x:-66,y:-3}),A2:e.addGroveCon({type:"P",es:"A",orient:"W",x:-66,y:22}),I1:e.addGroveCon({type:"P",es:"I",orient:"E",x:67,y:-39}),I2:e.addGroveCon({type:"P",es:"I",orient:"E",x:67,y:-14}),I3:e.addGroveCon({type:"P",es:"I",orient:"E",x:67,y:11}),SP:e.addGroveCon({type:"P",es:"R",orient:"S",x:-49,y:44}),SG:e.addGroveCon({type:"P",es:"S",orient:"S",x:-24,y:44})},n={D2:{x:0,y:151,a:90},D3:{x:46,y:151,a:90},D4:{x:92,y:151,a:90},D5:{x:151,y:-80,a:0},D6:{x:151,y:80,a:0},D7:{x:0,y:-141,a:-90},D8:{x:46,y:-141,a:-90},A0:{x:-151,y:-46,a:180},A1:{x:-151,y:0,a:180},A2:{x:-151,y:46,a:180},SP:{x:-92,y:151,a:90},SG:{x:-46,y:151,a:90}},r={count:3,used:0,0:t.I1,1:t.I2,2:t.I3};for(var o={},i=0;i<13;i++)for(var a=0;a<2;a++)o[2*i+a]=e.addSVG("line"),fillSVG(o[2*i+a],{stroke:"#333","stroke-width":"1",x1:3*i-69,y1:3*a-47,x2:3*i-68,y2:3*a-47});e.addCI({type:"4x",c:8,x:-13,y:0,orient:"N",scale:.5}),e.addLabel("GrovePi +",{x:-36,y:18,scale:.9});var l={};function d(e,t){for(var n in t)if(void 0!=l[t[n]])return l[t[n]].name!=e?2:1;return 0}function c(e){return l[e].module}var s=-1;function u(o,i,a){switch(d(o,i)){case 0:trace(2,"declaration",{name:o,addr:serial(i)});var u=(h=i[0],m=e.position(),isSet(n[h])?(m.x+=n[h].x,m.y+=n[h].y,m.a+=n[h].a,m):null),f=a();if(null!=u)f.placing(u),newGroveWire(t[i[0]],f.connector);else{var v=f.element.getBBox(),p=481+v.width/2;s<0?s=15+v.height/2:s+=15+v.height,f.placing({x:p,y:s,a:0}),newGroveWire(function(){var e=r[r.used++];if(r.used<r.count)return e;var t=newGroveI2Chub();return t.element.move(450,s+30),newGroveWire(e,t.connector[0]),r[r.count++]=t.connector[3],r[r.count++]=t.connector[2],r[r.count++]=t.connector[1],r[r.used++]}(),f.connector)}return function(e,t,n){for(var r in t)l[t[r]]={name:e,module:n}}(o,i,f),0;case 1:return trace(2,"reinit",{name:o}),(f=c(i[0])).reinit(),1;default:error("err_1",{name:o})}var h,m;return 2}return{connecteurs:t,element:e,addModule:function(e,n){switch(trace(2,"addModule",{name:e,opt:opt2str(n)}),e){case"Grove LED":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveLED(n.color)});break;case"Grove Button":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveButton(n.index)});break;case"Grove Ultrasonic":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveUltrasonic(n.index)});break;case"Grove Buzzer":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveBuzzer()});break;case"Grove Relay":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveRelay()});break;case"Grove cRVB":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveChainableRGBLed(n.cnt)});break;case"Grove LED Bar":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveLedBar()});break;case"Grove DHT":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveDHT(n.index)});break;case"Grove PIR Motion":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGrovePIR(n.index)});break;case"Grove IR Line Finder":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGroveIRLF(n.index)});break;case"Grove 4 digit":void 0!=t["D"+n.addr]&&u(e,["D"+n.addr],function(){return newGrove4digit()});break;case"Grove GPS":u(e,["SP"],function(){return newGroveGPS(n.index)});break;case"Grove LCD RGB Backlight":u(e,["i2c 0x3e","i2c 0x62"],function(){return newGroveLCDRGBBacklight()});break;case"Grove oLED display 128x64":u("Grove oLED display",["i2c 0x3c"],function(){return newGroveOLED128x64()});break;case"Grove oLED display 96x96":u("Grove oLED display",["i2c 0x3c"],function(){return newGroveOLED96x96()});break;case"Grove oLED display 128x128":u("Grove oLED display",["i2c 0x3c"],function(){return newGroveOLED128x128()});break;case"Grove Motor Driver":u(e,["i2c "+addr2hex(n.addr)],function(){return newGroveMotorDriver(n.addr)})}},getByAddress:function(e){try{return c(e)}catch(e){return trace(1,"exception",e),null}},getModule:function(e,t){switch(trace(2,"getModule",{name:e}),e){case"Grove LCD RGB Backlight":if(1==d(e,["i2c 0x3e","i2c 0x62"]))return c("i2c 0x3e");break;case"Grove oLED display":if(1==d(e,["i2c 0x3c"]))return c("i2c 0x3c");break;case"Grove LED":case"Grove Button":case"Grove Ultrasonic":case"Grove Relay":if(1==d(e,["D"+t.addr]))return c("D"+t.addr);break;case"Grove GPS":if(1==d(e,["SP"]))return c("SP")}return null},reinit:function(){},serialize:function(){var t="";for(var n in l)t+="{"+n+":("+l[n].module.element.serialize()+")}";return"GrovePi("+e.serialize()+"){"+t+"}"},unserialize:function(t){var n;if(null!=(n=t.match(/^GrovePi\(([^)]+)\){(({[^}]+})*)}/))){for(var r=e.unserialize(n[1]),o=n[2];null!=(n=o.match(/^{([^:]+):\(([^}]+)\)}(.*)/));)void 0!=l[n[1]]?r&=l[n[1]].module.element.unserialize(n[2]):r=!1,o=n[3];return r}return!1}}}function newTSmatrixLED(e,t){for(var n=makeDevice({bgcolor:"#ddd",board:"Direct m-"+(10+5*e)+",-"+5*t+" h"+(20+10*e)+" v"+10*t+" h-"+(20+10*e)+" z"}),r=n.addLedCon({orient:"W",x:-10-5*e,y:10-5*t}),o={},i=-5*e,a=-5*t,l=i+10*e,d=0;d<t;d++){fillSVG(n.addSVG("line"),{stroke:"#333","stroke-width":"0.7",x1:i,y1:a+1+10*d,x2:l,y2:a+1+10*d}),fillSVG(n.addSVG("line"),{stroke:"#333","stroke-width":"0.7",x1:i,y1:a+9+10*d,x2:l,y2:a+9+10*d});for(var c=0;c<e;c++){fillSVG(n.addSVG("path"),{fill:"#aaa",stroke:"none","stroke-width":"0",d:"m"+(i+10*c)+","+(a+10*d+2)+" q2,1 0,2 q2,1 0,2 q2,1 0,2 z"}),fillSVG(n.addSVG("path"),{fill:"#aaa",stroke:"none","stroke-width":"0",d:"m"+(i+10*c+10)+","+(a+10*d+2)+" q-2,1 0,2 q-2,1 0,2 q-2,1 0,2 z"}),fillSVG(n.addSVG("path"),{fill:"#eee",stroke:"#333","stroke-width":"1",d:"m"+(i+10*c+3)+","+(a+10*d+3)+" h4 v4 h-4 z"}),fillSVG(n.addSVG("circle"),{fill:"#ddd",stroke:"#333","stroke-width":"0.5",cx:i+10*c+5,cy:a+10*d+5,r:"2"}),o[d*e+c]=n.addSVG("circle"),fillSVG(o[d*e+c],{fill:"#000",opacity:"0",stroke:"none","stroke-width":"0",cx:i+10*c+5,cy:a+10*d+5,r:"4"})}fillSVG(n.addSVG("path"),{fill:"#fff",stroke:"#222","stroke-width":"1",d:"m"+(i-10)+","+(a+10*d+1)+" h12 v8 h-12 z"}),fillSVG(n.addSVG("path"),{fill:"#fff",stroke:"#222","stroke-width":"1",d:"m"+(l-2)+","+(a+10*d+1)+" h12 v8 h-12 z"})}return{element:n,connector:r,set:function(e){for(var t=0,n=3;n<e.length;n++)if("z"==e[n])for(var r=parseInt(e[++n],35),i=intToCol(parseInt(e[++n],35)),a=alpha(parseInt(e[n],35));r-- >0;)fillSVG(o[t++],{fill:i,opacity:a});else fillSVG(o[t++],{fill:intToCol(parseInt(e[n],35)),opacity:alpha(parseInt(e[n],35))})},reinit:function(){for(var e in o)fillSVG(o[e],{fill:"#000",opacity:"0"})}}}function newTSneoLED(){var e=makeDevice({bgcolor:"#ddd",board:"Direct m-50,-50 h100 v100 h-100 z"});EnvData.addBubble(e,"Shield TS néoLed");for(var t={},n=0;n<20;n++)for(var r=0;r<2;r++)t[2*n+r]=e.addSVG("line"),fillSVG(t[2*n+r],{stroke:"#333","stroke-width":"1",x1:3*r-47,y1:3*n-47,x2:3*r-46,y2:3*n-47});for(n=0;n<20;n++)for(r=0;r<2;r++)t[40+2*n+r]=e.addSVG("line"),fillSVG(t[40+2*n+r],{stroke:"#333","stroke-width":"1",x1:47-3*r,y1:47-3*n,x2:48-3*r,y2:47-3*n});fillSVG(e.addSVG("path"),{fill:"#eee",stroke:"#333","stroke-width":"1",d:"m-46,46 v-10 h20 v-3 h10 v3 h30 v10 z"});for(n=0;n<12;n++)for(r=0;r<2;r++)t[80+2*n+r]=e.addSVG("circle"),fillSVG(t[80+2*n+r],{fill:"#999",stroke:"#111","stroke-width":"0.3",cx:5*n-43,cy:43-5*r,r:2});fillSVG(e.addSVG("circle"),{fill:"#e00",stroke:"#111","stroke-width":"1.3",cx:"-23",cy:"13",r:"6"});var o=e.addSVG("path"),i=e.addSVG("path");fillSVG(o,{fill:"#a11",stroke:"#000","stroke-width":"1",d:"m-10,9 h13 v7 h-13 z"}),e.addLabel("5v",{color:"#a11",x:-15,y:15,scale:.5}),fillSVG(i,{fill:"#1a1",stroke:"#000","stroke-width":"1",d:"m9,9 h13 v7 h-13 z"}),e.addLabel("12v",{color:"#1a1",x:20,y:15,scale:.5}),e.addCI({type:"2x",c:7,x:-23,y:-23,orient:"N"}),e.addLabel("Technologie",{color:"#225",x:-10,y:-35,scale:.7}),e.addLabel("Service",{color:"#225",x:12,y:-24,scale:.7}),e.addLabel("NéoLED",{color:"#225",x:0,y:0,scale:.9});var a={L1:e.addLedCon({orient:"N",x:0,y:-42}),L2:e.addLedCon({orient:"N",x:33,y:-42})},l={};return{element:e,connecteurs:a,addMatrix:function(e,t,n){trace(2,"addMatrix",{con:e,width:t,height:n});try{if(void 0!=a["L"+e]){var r=newTSmatrixLED(t,n);newTSLedWire(a["L"+e],r.connector),l["L"+e]=r}}catch(e){trace(1,"exception",e)}},sendRequest:function(e){if(void 0!=l["L"+e[2]])switch(e[0]){case"fixeLED":l["L"+e[2]].set(e);break;case"resetLED":l["L"+e[2]].reinit()}else error("err_2",{port:e[2]})},serialize:function(){var t="";for(var n in l)t+="{"+n+":("+l[n].element.serialize()+")}";return"TSNeoLed("+e.serialize()+"){"+t+"}"},unserialize:function(t){var n;if(null!=(n=t.match(/^TSNeoLed\(([^)]+)\){(({[^}]+})*)}/))){for(var r=e.unserialize(n[1]),o=n[2];null!=(n=o.match(/^{([^:]+):\(([^}]+)\)}(({[^}]+})*)/));)void 0!=l[n[1]]?r&=l[n[1]].element.unserialize(n[2]):r=!1,o=n[3];return r}return!1},reinit:function(){}}}function addGrovePiModule(e,t){null==priv.GrovePi?error("err_3"):priv.GrovePi.addModule(e,t)}function sendToGrovePiModule(e,t,n){if(null==priv.GrovePi)error("err_3");else{var r=priv.GrovePi.getModule(e,t);null==r?error("err_4",{module:e}):n(r)}}var actionneurs=[],capteurs=[];function breakError(e,t,n){return connectionSend(e+"/"+t+"/"+n),!1}var Simulateur={};return Simulateur.priv=priv,Simulateur.init=function(e,t){document.body.style.backgroundColor="#e84",board_name.appendChild(newText("Carte "+t)),priv.ext_tools=e},Simulateur.sendOrder=function(e){try{var t=e.split("/");switch(trace(2,"order",{order:t[0],message:e}),t[0]){case"addShield":switch(t[2]){case"1":null==priv.GrovePi?(priv.GrovePi=newGrovePi(),priv.GrovePi.element.move(200,300)):priv.GrovePi.reinit();break;case"2":var n=parseInt(t[1]);isSet(priv.ServoHat[n])?priv.ServoHat[n].reinit():priv.ServoHat[n]=newServoHat(n);break;case"3":null==priv.TSNeoLed?(priv.TSNeoLed=newTSneoLED(),priv.TSNeoLed.element.move(200,300)):priv.TSNeoLed.reinit()}break;case"setDigit":n=parseInt(t[2]);switch(t[3]){case"1":var r=16711680;t[4].length>0&&parseInt(t[4])>0&&(r=parseInt(t[4])),addGrovePiModule("Grove LED",{addr:n,color:r});break;case"2":addGrovePiModule("Grove Relay",{addr:n});break;case"3":addGrovePiModule("Grove Button",{addr:n,index:parseInt(t[4])});break;case"4":addGrovePiModule("Grove Buzzer",{addr:n});break;case"5":addGrovePiModule("Grove cRVB",{addr:n,cnt:parseInt(t[4])});break;case"6":addGrovePiModule("Grove LED Bar",{addr:n});break;case"7":addGrovePiModule("Grove 4 digit",{addr:n});break;case"8":addGrovePiModule("Grove Ultrasonic",{addr:n,index:parseInt(t[4])});break;case"9":addGrovePiModule("Grove DHT",{addr:n,index:parseInt(t[4])});break;case"10":addGrovePiModule("Grove PIR Motion",{addr:n,index:parseInt(t[4])});break;case"11":addGrovePiModule("Grove IR Line Finder",{addr:n,index:parseInt(t[4])})}break;case"digitWrite":if(null==priv.GrovePi)error("err_3");else null==(o=priv.GrovePi.getByAddress("D"+t[2]))?error("err_5",{addr:t[2]}):o.set("1"==t[3]);break;case"CLED":if(null==priv.GrovePi)error("err_3");else null==(o=priv.GrovePi.getByAddress("D"+t[2]))?error("err_5",{addr:t[2]}):o.isChainable&&"set"==t[3]&&o.set(parseInt(t[4]),t[5]);break;case"LBar":if(null==priv.GrovePi)error("err_3");else if(null==(o=priv.GrovePi.getByAddress("D"+t[2])))error("err_5",{addr:t[2]});else if(o.isLedBar)switch(t[3]){case"set":o.set(parseInt(t[4]),parseInt(t[5]));break;default:o.conf(t[3])}break;case"4DD":var o;if(null==priv.GrovePi)error("err_3");else null==(o=priv.GrovePi.getByAddress("D"+t[2]))?error("err_5",{addr:t[2]}):o.isDigitDisp&&o.aff(t[4]);break;case"setAnalog":n=parseInt(t[2]),r=0;t[3];break;case"setModule":switch(t[2]){case"1":addGrovePiModule("Grove LCD RGB Backlight");break;case"2":addGrovePiModule("Grove oLED display 128x64");break;case"3":addGrovePiModule("Grove oLED display 96x96");break;case"4":addGrovePiModule("Grove oLED display 128x128");break;case"5":addGrovePiModule("Grove GPS",{index:parseInt(t[3])});break;case"6":addGrovePiModule("Grove Motor Driver",{addr:parseInt(t[3])});break;case"7":addGrovePiModule("Grove miniTrackBall",{index:parseInt(t[3])})}break;case"LCD":sendToGrovePiModule("Grove LCD RGB Backlight",{},function(e){switch(t[2]){case"print":e.print(t[3],t[4]);break;case"color":e.setColor(t[3]);break;case"set":switch(t[3]){case"1":e.clear()}}});break;case"oLED":sendToGrovePiModule("Grove oLED display",{},function(e){switch(t[2]){case"print":e.print(t[3]);break;case"move":e.gotoXY(parseInt(t[3]),parseInt(t[4]))}});break;case"initLED":null==priv.TSNeoLed?error("err_6"):priv.TSNeoLed.addMatrix(t[2],t[3],t[4]);break;case"fixeLED":case"resetLED":null==priv.TSNeoLed?error("err_6"):priv.TSNeoLed.sendRequest(t)}}catch(e){trace(1,"exception",e)}},Simulateur}var Modules=makeModule();window.Modules||(window.Modules=Modules)}(window);
